<!-- OUT -->
<?xml version="1.0"?>
<stream:stream xmlns="jabber:client"
               xmlns:stream="http://etherx.jabber.org/streams"
               to="is-a-furry.org"
               version="1.0">
               
<!-- IN -->
<?xml version='1.0'?>
<stream:stream xmlns:stream='http://etherx.jabber.org/streams'
               version='1.0'
               from='is-a-furry.org'
               id='aee006eb-6180-46c0-8598-6e55c2ecb605'
               xml:lang='en'
               xmlns='jabber:client'>
  <stream:features>
    <register xmlns='http://jabber.org/features/iq-register'/>
    <starttls xmlns='urn:ietf:params:xml:ns:xmpp-tls'><required/></starttls>
  </stream:features>
  
  
// 开始 TLS
<!-- OUT -->
<starttls xmlns="urn:ietf:params:xml:ns:xmpp-tls"/>

<!-- IN -->
<proceed xmlns='urn:ietf:params:xml:ns:xmpp-tls'/>

<!-- OUT -->
<?xml version="1.0"?>
<stream:stream xmlns="jabber:client"
               xmlns:stream="http://etherx.jabber.org/streams"
               to="is-a-furry.org"
               version="1.0">
               
<!-- IN -->
<?xml version='1.0'?>
<stream:stream xmlns:stream='http://etherx.jabber.org/streams'
               version='1.0'
               from='is-a-furry.org'
               id='64f57a2d-66a8-4988-9118-025a15853958'
               xml:lang='en'
               xmlns='jabber:client'>
  <stream:features>
    <register xmlns='http://jabber.org/features/iq-register'/>
    <mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>
      <mechanism>SCRAM-SHA-1</mechanism>
      <mechanism>PLAIN</mechanism>
    </mechanisms>
    <auth xmlns='http://jabber.org/features/iq-auth'/>
  </stream:features>
  
<!-- OUT -->
<auth xmlns="urn:ietf:params:xml:ns:xmpp-sasl" mechanism="SCRAM-SHA-1">
  biwsbj10a3Jvc2Uscj1kMzc5ZjU4ZS01MTU5LTRhM2QtYjU5OS1jNjdjYjc3NTc2NDk=
</auth>

<!-- IN -->
<challenge xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>
  cj1kMzc5ZjU4ZS01MTU5LTRhM2QtYjU5OS1jNjdjYjc3NTc2NDk0MDNhM2JjZS1iOTFkLTQ0NjQtOWU2Ny05NzE3MzM2ZWY3ZWUscz1PVGxrTldVNE9HTXROemd3TkMwME1HRXdMV0U0Tm1ZdE5UWmlOelZqWW1SbU1qYzUsaT00MDk2
</challenge>

<!-- OUT -->
<response xmlns="urn:ietf:params:xml:ns:xmpp-sasl">
  Yz1iaXdzLHI9ZDM3OWY1OGUtNTE1OS00YTNkLWI1OTktYzY3Y2I3NzU3NjQ5NDAzYTNiY2UtYjkxZC00NDY0LTllNjctOTcxNzMzNmVmN2VlLHA9cWZ3WjFIdVNNSmNkRHNYUkJadWc1czdPUkhJPQ==
</response>

<!-- IN -->
<success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'>
  dj0rRGNaQzZRZGs0cHU1RHBwNkFaK1lSZnQzbVk9
</success>


// TLS 成功后
<!-- OUT -->
<?xml version="1.0"?>
<stream:stream xmlns="jabber:client" 
               xmlns:stream="http://etherx.jabber.org/streams" 
               to="is-a-furry.org" 
               version="1.0">
               
<!-- IN -->
<?xml version='1.0'?>
<stream:stream xmlns:stream='http://etherx.jabber.org/streams' 
               version='1.0' 
               from='is-a-furry.org' 
               id='fa3a430c-2d72-408e-ae36-0ebf4934f1bc' 
               xml:lang='en' 
               xmlns='jabber:client'>
  <stream:features>
    <compression xmlns='http://jabber.org/features/compress'>
      <method>zlib</method>
    </compression>
    <ver xmlns='urn:xmpp:features:rosterver'/>
    <sm xmlns='urn:xmpp:sm:2'><optional/></sm>
    <sm xmlns='urn:xmpp:sm:3'><optional/></sm>
    <c hash='sha-1' ver='O8I2YTghBXfP1v4WNjYb7iuIkxE=' node='http://prosody.im' xmlns='http://jabber.org/protocol/caps'/>
    <bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'><required/></bind>
    <session xmlns='urn:ietf:params:xml:ns:xmpp-session'><optional/></session>
  </stream:features>
  
<!-- OUT -->
<compress xmlns='http://jabber.org/protocol/compress'>
  <method>zlib</method>
</compress>

<!-- IN -->
<compressed xmlns='http://jabber.org/protocol/compress'/>

<!-- OUT -->
<?xml version="1.0"?>
<stream:stream xmlns="jabber:client" 
               xmlns:stream="http://etherx.jabber.org/streams" 
               to="is-a-furry.org" 
               version="1.0">
               
<!-- IN -->
<?xml version='1.0'?>
<stream:stream xmlns:stream='http://etherx.jabber.org/streams' 
               version='1.0' 
               from='is-a-furry.org' 
               id='c138f1ad-53ed-4061-b2db-88e420f9e3f3' 
               xml:lang='en' 
               xmlns='jabber:client'>
  <stream:features>
    <ver xmlns='urn:xmpp:features:rosterver'/>
    <sm xmlns='urn:xmpp:sm:2'><optional/></sm>
    <sm xmlns='urn:xmpp:sm:3'><optional/></sm>
    <c hash='sha-1' ver='O8I2YTghBXfP1v4WNjYb7iuIkxE=' node='http://prosody.im' xmlns='http://jabber.org/protocol/caps'/>
    <bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'><required/></bind>
    <session xmlns='urn:ietf:params:xml:ns:xmpp-session'><optional/></session>
  </stream:features>
  
  
// 开始资源绑定
<!-- OUT -->
<iq id="session-bind" type="set">
  <bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"/>
</iq>

<!-- IN -->
<iq id='session-bind' type='result'>
  <bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'>
    <jid>tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e</jid>
  </bind>
</iq>


<!-- OUT -->
<enable xmlns="urn:xmpp:sm:2"/>

<!-- IN -->
<enabled xmlns='urn:xmpp:sm:2'/>

<!-- OUT -->
<iq id="session-start" type="set">
  <session xmlns="urn:ietf:params:xml:ns:xmpp-session"/>
</iq>

<!-- IN -->
<iq id='session-start' type='result' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e'/>
<r xmlns='urn:xmpp:sm:2'/>


// 获取 vCard, 后边返回了 item not found
<!-- OUT -->
<iq id="418e460f-24b4-4cc3-805e-fc4d0ae9d021" type="get">
  <vCard xmlns="vcard-temp"/>
</iq>

<!-- OUT -->
<iq id="da4652e1-2744-44cb-b08d-49b3e5e6fc77" type="get">
  <query xmlns="jabber:iq:private">
    <storage xmlns="storage:bookmarks"/>
  </query>
</iq>

// 获取 roster
<!-- OUT -->
<iq id="bb589560-f95f-4bfd-9be1-4b605b4b0069" type="get">
  <query ver="1" xmlns="jabber:iq:roster"/>
</iq>

<!-- OUT -->
<iq id="0de73810-601b-4db3-943a-23157c91e9e3" to="is-a-furry.org" type="get">
  <query xmlns="http://jabber.org/protocol/disco#info"/>
</iq>

<!-- OUT -->
<presence>
  <status></status>
  <c hash="sha-1" node="http://swift.im" ver="rs/tl9NCfXBpKoOYUy+JdBbPGDg=" xmlns="http://jabber.org/protocol/caps"/>
</presence>

<!-- OUT -->
<a h="1" xmlns="urn:xmpp:sm:2"/>

<!-- IN -->
<iq id='418e460f-24b4-4cc3-805e-fc4d0ae9d021' type='error' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e'>
  <error type='cancel'>
    <item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/>
  </error>
</iq>

<!-- IN -->
<iq id='da4652e1-2744-44cb-b08d-49b3e5e6fc77' type='result' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e'>
  <query xmlns='jabber:iq:private'>
    <storage xmlns='storage:bookmarks'/>
  </query>
</iq>

<iq id='bb589560-f95f-4bfd-9be1-4b605b4b0069' type='result' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e'/>

<iq id='0de73810-601b-4db3-943a-23157c91e9e3' type='result' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e' from='is-a-furry.org'>
  <query xmlns='http://jabber.org/protocol/disco#info'>
    <identity type='pep' name='Prosody' category='pubsub'/>
    <identity type='im' name='Prosody' category='server'/>
    <feature var='http://jabber.org/protocol/commands'/>
    <feature var='http://jabber.org/protocol/pubsub#publish'/>
    <feature var='msgoffline'/>
    <feature var='jabber:iq:privacy'/>
    <feature var='jabber:iq:register'/>
    <feature var='jabber:iq:roster'/>
    <feature var='urn:xmpp:time'/>
    <feature var='jabber:iq:time'/>
    <feature var='jabber:iq:private'/>
    <feature var='jabber:iq:search'/>
    <feature var='urn:xmpp:ping'/>
    <feature var='http://jabber.org/protocol/disco#info'/>
    <feature var='http://jabber.org/protocol/disco#items'/>
    <feature var='jabber:iq:version'/>
    <feature var='vcard-temp'/>
    <feature var='jabber:iq:last'/>
    <feature var='jabber:iq:auth'/>
  </query>
</iq>

<presence from='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e'>
  <status/>
  <c hash='sha-1' ver='rs/tl9NCfXBpKoOYUy+JdBbPGDg=' node='http://swift.im' xmlns='http://jabber.org/protocol/caps'/>
</presence>

<presence type='unavailable' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e' from='arsimael@im.it-native.de'/>

<!-- OUT -->
<iq id="c89ec5b3-1427-4dc8-a825-046adc35c4d0" to="is-a-furry.org" type="get">
  <query node="http://jabber.org/protocol/commands" xmlns="http://jabber.org/protocol/disco#items"/>
</iq>

<!-- IN -->
<iq id='c89ec5b3-1427-4dc8-a825-046adc35c4d0' type='result' to='tkrose@is-a-furry.org/2e1e45c2-7688-407b-97ed-cb1a8592825e' from='is-a-furry.org'>
  <query node='http://jabber.org/protocol/commands' xmlns='http://jabber.org/protocol/disco#items'>
    <item jid='is-a-furry.org' name='Search settings' node='vjudsetup'/>
    <item jid='is-a-furry.org' name='Ping' node='ping'/>
    <item jid='is-a-furry.org' name='Get uptime' node='uptime'/>
  </query>
</iq>

<r xmlns='urn:xmpp:sm:2'/>

<!-- OUT -->
<a h="8" xmlns="urn:xmpp:sm:2"/>

<!-- OUT -->
<a h="8" xmlns="urn:xmpp:sm:2"/>

<!-- OUT -->
</stream:stream>
